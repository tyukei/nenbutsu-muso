# GEMINI.md - プロジェクトガイド

このドキュメントは、このプロジェクト「煩悩退散〜修行僧の葛藤〜」の開発を支援するAI（Gemini）のためのガイドラインです。

## プロジェクト概要

「煩悩退散」は、修行僧が迫り来る「煩悩」を「読経」で撃ち落とす、ブラウザベースのシューティングゲームです。PCとモバイルの両方に対応しており、難易度設定やランキング機能を備えています。

## 技術スタック

*   **HTML5**: セマンティックなマークアップ (`index.html`)。
*   **CSS3**: フレームワークを使用しないカスタムスタイル (`assets/css/main.css`)。
*   **JavaScript (ES6+)**: 外部ライブラリやゲームエンジンを使用しないVanilla JS (`assets/js/main.js`)。
*   **アセット**: 画像 (`images/`) と音声 (`sounds/`) ファイルを使用。

## ディレクトリ構成

*   `/`: ルートディレクトリ (`index.html`, `GEMINI.md`)。
*   `assets/`:
    *   `css/`: スタイルシート。
    *   `js/`: ゲームロジック (`main.js`)。
*   `images/`: キャラクター、UI、背景などの画像リソース。
    *   `monk/`: 僧侶の画像 (`monk_back.png`, `monk_happy.png` 等)。
    *   `tutorial/`: チュートリアル用画像。
*   `sounds/`: BGM (`bgm.wav`) と効果音 (`shoot.mp3`, `hit.mp3` 等)。
*   `docs/`: ドキュメント関連。

## 主要なゲームシステム

### 1. ゲームループと状態管理
*   **ゲーム状態 (`gameState`)**: `'title'`, `'level'`, `'playing'`, `'gameover'`, `'ranking'` のいずれかの値を持ち、画面遷移とゲームロジックを制御します。
*   **メインループ**: `requestAnimationFrame` を使用（`main.js` 内で実装）。

### 2. 入力処理
*   **PC**: キーボード操作 (矢印キーで移動, Spaceで発射, Zで必殺技)。`keys` オブジェクトで状態を管理。
*   **モバイル**: 画面上の仮想ボタン (`virtualControls`) によるタッチ操作。`touchstart`, `touchend` イベントを使用。
*   **モバイル判定**: `checkMobileMode()` 関数で画面幅または設定に基づき `mobile-mode` クラスを `body` に付与。

### 3. ゲームプレイ機能
*   **精神力 (HP)**: `spirit` 変数で管理。被弾すると減少。
*   **功徳 (MP)**: `kudoku` 変数で管理。敵を倒すと蓄積し、満タンで必殺技「煩悩即菩薩」が使用可能。
*   **レベルシステム**: `easy` (仏性Lev1) 〜 `demon` (悪魔レベル)。`levelSettings` オブジェクトでパラメータ（速度、出現率、ターゲットスコア等）を定義。
*   **自動レベル解放**: クリア状況を `localStorage` (`nenbunClearedLevels`) に保存。パスワードによる解放機能もあり。

### 4. 音声管理
*   **Audio オブジェクト**: `sounds` オブジェクトで一元管理。
*   **モバイル対応**: `unlockAudio()` 関数により、ユーザーインタラクション時に音声をアンロック（無音再生）して自動再生制限を回避。

### 5. データ永続化
*   **ランキング**: `localStorage` (`nenbunRankings`) にスコア、連鎖数、日付を保存。
*   **設定**: `localStorage` (`nenbunSettings`) に音声設定や操作モードを保存。

## 開発ガイドライン

1.  **言語**: コード内のコメント、変数名（意図が分かる場合）、およびUIテキストは日本語を使用してください。
2.  **依存関係**: 新たなnpmパッケージや外部ライブラリの追加は避け、標準Web APIで実装してください。
3.  **レスポンシブデザイン**: モバイル表示（スマホ縦持ち）を優先し、PC表示でも崩れないようにCSSを調整してください。
4.  **コードスタイル**:
    *   `const`/`let` を適切に使い分ける。
    *   DOM要素の取得はファイル上部でまとめて行う。
    *   イベントリスナーは適切に管理する。

## 今後の拡張について
*   新機能を追加する際は、既存の `gameState` フローを壊さないように注意してください。
*   新しいアセット（画像・音声）を使用する場合は、適切なディレクトリに配置し、パスを確認してください。
